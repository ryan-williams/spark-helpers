#!/usr/bin/env bash

if [ -z "$sparks" ]; then
  export sparks="$HOME/sparks"
elif [ ! -d "$sparks" ]; then
  echo "\$sparks directory $sparks not actually a directory!" 1>&2
fi
mkdir -p "$sparks"

get_sha_and_hadoop_version() {
  if [ $# -gt 0 ]; then
    sha="$1"
    shift
  fi

  if [ -z "$hadoop_version" ]; then
    if [ $# -gt 0 ]; then
      hadoop_version="$1"
      shift
    else
      hadoop_version="${SPARK_HADOOP_VERSION:-2.4}"
    fi
  fi
}

get_hadoop_args() {
  if [ "$hadoop_version" == "2.2" ]; then
    hadoop_args="-Phadoop-${hadoop_version}"
  elif [ "$hadoop_version" == "2.3" ]; then
    hadoop_args="-Phadoop-${hadoop_version} -Dhadoop.version=2.3.0"
  elif [ "$hadoop_version" == "2.4" -o "$hadoop_version" == "2.5" ]; then
    hadoop_args="-Phadoop-${hadoop_version} -Dhadoop.version=2.4.0"
  else
    echo "Hadoop version must be 2.2, 2.3, 2.4, or 2.5" 1>&2
    exit 1
  fi
}

get_spark_dir() {
  spark_dir="spark-${sha}-bin-hadoop${hadoop_version}"
  if [ -n "$sparks" ]; then
    spark_dir="$sparks/$spark_dir"
  fi
}

alias spark-select=". spark-select-impl"
